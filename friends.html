<!DOCTYPE html>
<html>
<head>
    <title>Epic Games Friends</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A friends list online checker for fortnite and epic games.">
    <link rel="shortcut icon" href="images/favicon.webp" type="image/png">
</head>
<body>
    <h1>Welcome, <span id="userName"></span></h1>
    <button id="linkAccount" class="linkAccount">Link Epic Games Account</button>
    <h2>Online Friends</h2>
    <div id="friendsList"></div>
    <style>
body {
    font-family: sans-serif;
    background-color: #1e1e1e;
    color: #fff;
    text-align: center;
}
.linkAccount {
  font-size: 28px;
  line-height: 1.5;
  color: #ffffffd8;
  text-decoration: none;
  margin-bottom: 30px;
  padding: 10px;
  background-color: #333;
  border-radius: 10px;
  transition: all 0.2s ease-in-out;
  width: auto;
  height: auto;
  text-align: center;
  border: none;
  outline: none; 
}
.linkAccount:hover {
  background-image: linear-gradient(to bottom right, #0077c2, #2b008f, #19005e);
  color: #fff;
  scale: 1.1;

}
    </style>
    <script>
       document.getElementById('linkAccount').addEventListener('click', () => {
    // Step 1: Redirect the user to the authorization URL
    const authURL = 'https://www.epicgames.com/id/authorize?client_id=xyza7891mFSqBwMaLNte4T0T3RCXGlO3&response_type=code&scope=basic_profile';
    window.location.href = authURL;
});

// Assuming you have a function to get URL parameters
function getURLParameter(name) {
    return decodeURIComponent((new RegExp('[?|&]' + name + '=' + '([^&;]+?)(&|#|;|$)').exec(location.search)||[,""])[1].replace(/\+/g, '%20'))||null;
}

window.onload = function() {
    // Step 3: Epic Games redirects the user back to your application with a code
    // Capture this code from the URL
    const code = getURLParameter('code');

    if (code) {
        // Step 4: Exchange the code for an access token
        const tokenURL = 'https://oauth.epicgames.com/token';
        const data = {
            code: code,
            client_id: 'xyza7891mFSqBwMaLNte4T0T3RCXGlO3',
            client_secret: 'txoYAfed+r7yAeSxSPOA4FBW1n0fwq/galPCOFObX/Y',
            redirect_uri: 'https://thedog.codes/friends',
            grant_type: 'authorization_code'
        };

        fetch(tokenURL, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
            // Step 5: Extract the access token from the response
            const accessToken = data.access_token;

            // Use the access token to fetch the user's name and friends list
            const API_URL = data.access_token; // Replace with your API URL
            fetch(API_URL, {
                headers: {
                    'Authorization': `Bearer ${accessToken}`
                }
            })
            .then(response => response.json())
            .then(data => {
                // Display the user's name
                document.getElementById('userName').textContent = data.user.name;
            });
        });
    }
};
    </script>
</body>
</html>